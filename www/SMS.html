<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<title>交流</title>
<head>
<meta http-equiv="pragma" content="no-cache"  />
<meta http-equiv="content-type" content="no-cache, must-revalidate" />
<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" href="css/jquery.mobile-1.4.2.css" />
<link rel="stylesheet" href="css/SMS.css">
<link rel="stylesheet" href="css/CommonStyle.css">
<script src="jquery-mobile/jquery-2.1.3.js"></script>
<script src="jquery-mobile/jquery.mobile-1.4.2.js"></script>
<script type="text/javascript" src="js/CommonUtility.js"></script>
<script type="text/javascript" src="js/Resize.js"></script>
<script type="text/javascript" src="js/SMS.js"></script>
<script>
//强制使用长链接
//      window.WEB_XHR_POLLING = true;
//强制使用flash
//      window.WEB_SOCKET_FORCE_FLASH = true;
</script>
<!--<script src="http://res.websdk.rong.io/RongIMClient-0.9.6.min.js"></script>-->
</head>
<body>
<div data-role="page">
  <div data-role="header">
            <div id="imgtest-round" style="margin-left:10px;width:40px;height:40px;border-radius:100px;border:2px solid #fff;overflow:hidden;-webkit-box-shadow:0 0 3px #ccc;box-shadow:0 0 3px #ccc;" onclick="$('#Info').panel('open')">
                <img id="DoctorPhoto" style="width:100%;min-height:100%; text-align:center;" alt="头像" />
            </div>
             	<div class="ui-btn-right">
            <a id="Refresh" href="#" data-role="button" data-icon="refresh" data-iconpos="notext" onClick="window.location.reload(); ">Refresh</a>
        </div>
        	<h2 id="DoctorName" style="margin-top:-40px"></h2>
        </div>
        <div data-role="panel" id="Info" data-position="left" data-display="overlay" data-theme="a" class="ui-panel ui-panel-position-left ui-panel-display-overlay ui-body-a ui-panel-animate ui-panel-open">
            <div class="ui-panel-inner">
            	<button onclick = "javascript: window.location.href='BasicInfo.html'" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-user">
                	个人信息
                </button>
                <button onclick = "" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-cloud">
                	账号绑定
                </button>
                <button onclick = "" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-edit">
                	修改密码
                </button>
                <button onclick = "" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-gear">
                	设置
                </button>
                <button onclick = "" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-info">
                	关于
                </button>
                <button onclick = "BacktoLogOn()" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-action">
                	退出
                </button>
            </div>
        </div>

 
  <div data-role="content">
    <div  style="position:relative;margin-top:40px;" id= "GenaralField">
      <div id= "OutField" style="position:absolute; width: 99%;">
        <div class="NormalField" id="MainField"> </div>
        <table width="100%">
          <tr>
            <td align="center" width="89%"><textarea id="SMSContent" style="font-size:20px; padding:1px;margin:5px;"></textarea></td>
            <td></td>
            <td align="center" width="10%" valign="bottom"><button type="button" id="SMSbtn"> 发送</button></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  
 <div data-role="footer" data-id="foo1" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li onclick="javascript:location.href='TaskMenu.html'">
                    <a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-star">
                        任务
                    </a>
                </li>
                <li onclick="javascript:location.href='Target.html'">
                	<a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-heart">
                    	目标
                    </a>
                </li>
                <li>
                	<a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-comment ui-btn-active">
                		交流
                    </a>
                </li>
            </ul>
        </div><!-- /navbar -->
	</div>
  

</div>
</body>
<script>
	var ThisUserId = window.localStorage.getItem("ID");
	var TheOtherId = window.localStorage.getItem("DoctorId");
	var piUserId = window.localStorage.getItem("ID");
	var piTerminalName = "Y-PHONE";
	var piTerminalIP = window.localStorage.getItem("TerminalIP");
	var Device = window.localStorage.getItem("Device");
	var piDeviceType = (Device == "Phone")?1:0;
	
	var DocHeight = $(document).height();
	
	var ClickFlag = true;
	var AppKey = "sfci50a7chxxi";
	var InitialHt = $("#SMSContent").height(); //初始高度
	var InitialTop = $("#OutField").position().top; //初始位置
	var MaxHt = 0; //输入框最大高度
	
	$(document).ready(function(event){
	  $("#DoctorName").html(window.localStorage.getItem("DoctorName"));
	  $("#DoctorPhoto").attr("src", window.localStorage.getItem("DoctorPhoto"));
	  GetSMSDialogue(ThisUserId, TheOtherId);
	  document.getElementById('MainField').scrollTop = document.getElementById('MainField').scrollHeight;
	  
	  var SMSBtn = document.getElementById('SMSbtn');	
	  SMSBtn.addEventListener("mouseover", ChangeFlagToF, false);
	  SMSBtn.addEventListener("mouseout", ChangeFlagToT, false);
	  SMSBtn.addEventListener("click", submitSMS, false); //rongyun 20150615
	  
	  document.getElementById('SMSContent').style.height = "47px"; //设定文本域初始高度
	  $('#GenaralField').height(DocHeight-160); //设定文档高度
	})
	
	

	//autogrow初始化
	$("#SMSContent").textinput({
  		autogrow: true
	});
	
	//固定文本框下边框与添加滚动条
	$("#SMSContent").resize(function(){
		var PresentTop = $("#OutField").position().top; //获取当前位置
		var PresentHt = $("#SMSContent").height(); //获取当前始高度
		var t = document.getElementById('SMSContent'); 
		var h = t.scrollHeight; 
		if (PresentHt < 170)
		{
			$( "#SMSContent" ).textinput( "option", "autogrow", true );
			if (PresentHt != InitialHt)
			{
				var temp = PresentHt - InitialHt;
				InitialHt = PresentHt; //改变比较值
				$("#OutField").css("top", PresentTop - temp);
			}
		}
		else
		{
			if (MaxHt == 0)
			{
				MaxHt = PresentHt;
			}
			$( "#SMSContent" ).textinput( "option", "autogrow", false );
			h = h > MaxHt ? MaxHt : h;
				
			if (PresentHt != InitialHt)
			{
				var temp = PresentHt - InitialHt;
				InitialHt = PresentHt; //改变比较值
				$("#OutField").css("top", PresentTop - temp);
			}
		}
	});
		
	//退格到最大高度内后恢复autogrow
	document.onkeydown = function (event) 
	{				
		var e = event || window.event || arguments.callee.caller.arguments[0]; 
		var t = document.getElementById('SMSContent'); 
			
		if(e && e.keyCode == 8)
		{ 
			var a = document.getElementById('SMSContent').scrollTop;
			if ((a == 0) && ($("#SMSContent").height() <= MaxHt))
			{
				$( "#SMSContent" ).textinput( "option", "autogrow", true );
			}
		}
	}
		
</script>
</html>
