<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<title>血压测量</title>
	</head>
	<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.2.css" />
	<link rel="stylesheet" href="css/CommonStyle.css">
	<body>
		<div data-role="header" style="height:40px;">
        	<h2>血压测量</h2>
			<a href="javascript: window.history.back(-1);" data-icon="back" data-iconpos="notext" data-shadow="false"
                data-iconshadow="false">返回</a>
			
		</div>
		<div style="height:30px"></div>
		<div align="center">
			<p>
				<font size="6.5">收缩压</font>
			</p>
			<div align="center" style="height:75px; border-style:ridge; width:200px">
				<font size="7">
<!--					<input type="input" id="SBPget" value="120" size="3" readonly="true" style="border:hidden; text-align:center" />-->
<input type="input" id="SBPget" value="120" size="3"  style="border:hidden; text-align:center" />
				</font>
			</div>
		</div>
		<div align="center">
			<p>
				<font size="6.5">舒张压</font>
			</p>
			<div align="center" style="height:75px; border-style:ridge; width:200px">
				<font size="7">
<!--					<input type="input" id="DBPget" value="80" size="3" readonly="true" style="border:hidden; text-align:center" />-->
<input type="input" id="DBPget" value="80" size="3"  style="border:hidden; text-align:center" />
				</font>
			</div>
		</div>
		<div style="height:30px"></div>
		<p align="center">
			<button id="btn" onclick="Test1();" style="width:150px">
				<font size="6">保存</font>
			</button>
		</p>
		<br/>
	</body>
	<script src="jquery-mobile/jquery-2.1.3.js"></script>
	<script src="jquery-mobile/jquery.mobile-1.4.2.js"></script>
	<script src="js/CommonUtility.js"></script>
	<script src="js/jquery-spin.js"></script>
	<script type="text/javascript">
		//传进来的参数
		//var PatientId = "PID201501070012";
		var PatientId = window.localStorage.getItem("ID");
		 var TerminalIP = window.localStorage.getItem("TerminalIP");
		 var TerminalName = window.localStorage.getItem("TerminalName");
		 var DeviceType = window.localStorage.getItem("DeviceType");
		 var revUserId  = window.localStorage.getItem("ID");
		
		//仅该页面用到参数
		var MDate = "";
		var MTime = "";
		var SBP = "";
		var DBP = "";
		
		$(document).ready(function(event){
			$.spin.imageBasePath = './img/spin/';
			$('#SBPget').spin({
				max: 200,
				min: 50,
				timeInterval: 125
			});
			$('#DBPget').spin({
				max: 150,
				min: 30,
				timeInterval: 125
			});
		});
		
		function Test1()
		{
			SBP = parseInt($('#SBPget').val());
			DBP = parseInt($('#DBPget').val());
			if(DBP > SBP){
				alert("舒张压不可能高于收缩压，请重新填写");
				return;
			}
			$.ajax({  
				  type: "POST",
				  dataType: "xml",
				  timeout: 30000,  
				  url: 'http://'+ serverIP +'/'+serviceName+'/GetServerTime',
				  async:false,
				  data: {},
				  beforeSend: function(){},
				  success: function(result) {
					  MDate = $(result).text().slice(0,10).replace(/-/g,"");
					  MTime = $(result).text().slice(11,16).replace(":","");		    
				  }, 
				  error: function(msg) {alert("Error!");}
			  });
			SetPatientVitalSigns(PatientId, MDate, MTime, "Bloodpressure_1", SBP, revUserId, TerminalName, TerminalIP, DeviceType)
			SetPatientVitalSigns(PatientId, MDate, MTime, "Bloodpressure_2", DBP, revUserId, TerminalName, TerminalIP, DeviceType)
		}
		
		function SetPatientVitalSigns(UserId, RecordDate, RecordTime, ItemCode, Value, revUserId, TerminalName, TerminalIP, DeviceType)
		{
			var options;
			$.ajax({  
				type: "POST",
				dataType: "xml",
				timeout: 30000,  
				url: 'http://'+ serverIP +'/'+serviceName+'/SetPatientVitalSigns',
				async:false,
		        data: {UserId:UserId,
					   RecordDate:RecordDate,
					   RecordTime:RecordTime,
				       ItemType:"Bloodpressure",
					   ItemCode:ItemCode,
					   Value:Value,
					   Unit:"mmHg",
					   revUserId:revUserId,
					   TerminalName:TerminalName,
					   TerminalIP:TerminalIP,
					   DeviceType:DeviceType},//输入变量
				beforeSend: function(){},
		        success: function(result){ 
				    if(ItemCode == "Bloodpressure_1"){
						alert("收缩压录入成功");
					}
					if(ItemCode == "Bloodpressure_2"){
						alert("舒张压录入成功");
					}		    
		        }, 
		        error: function(msg) {alert("Error!");}
			});
			return options;	
		}
	</script>

</html>